<div class="faculty-schedule-timetable-container" [@fadeAnimation]>
  <div class="table-wrapper" #tableWrapper>
    <table class="faculty-schedule-timetable-table">
      <thead class="faculty-schedule-timetable-table-header">
        <tr>
          <th>Time</th>
          @for (day of days; track day) {
          <th>{{ day }}</th>
          }
        </tr>
      </thead>
      <tbody class="faculty-schedule-timetable-table-body">
        @for (slot of timeSlots; track slot; let i = $index) {
        <tr>
          <td class="time-slot">{{ slot.time }}</td>
          @for (day of days; track day) {
          <td
            class="schedule-cell"
            [ngClass]="{ 'schedule-block-start': isScheduleBlockStart(day, i) }"
            [ngStyle]="getScheduleBlockStyle(day, i)">
            @if (isScheduleBlockStart(day, i)) {
            <div
              class="schedule-content"
              [style.height.px]="getScheduleBlockHeight(day, i)"
              [ngClass]="getDayClass(day)">
              <div class="course">
                <span class="course-text">
                  {{ getBlockProperty(day, i, 'courseCode') }}<br />
                  {{ getBlockProperty(day, i, 'courseTitle') }}
                </span>
              </div>
              <div>
                ({{ getBlockProperty(day, i, 'program') }}
                {{ getBlockProperty(day, i, 'yearLevel') }}-{{
                  getBlockProperty(day, i, 'section')
                }})
              </div>
              <div>
                {{ getBlockProperty(day, i, 'roomCode') }}
              </div>
              <!-- Time + action buttons sticky at bottom -->
              <div class="time-actions">
                <div class="time">{{ getFormattedTime(day, i) }}</div>

                <!-- ── Block Action Buttons ── -->
                <div class="block-actions">
                  <!-- Flag / Appeal button -->
                  <button
                    mat-icon-button
                    class="edit-button"
                    (click)="onEditScheduleBlock(day, i)"
                    matTooltip="File an Appeal"
                    aria-label="Appeal Schedule Block">
                    <mat-icon class="block-icon">flag</mat-icon>
                  </button>

                  <!-- My Appeals history button -->
                  <button
                    mat-icon-button
                    class="appeals-status-button"
                    [ngClass]="getAppealStatusClass(day, i)"
                    (click)="onViewMyAppeals(day, i)"
                    [matTooltip]="getAppealStatusTooltip(day, i)"
                    aria-label="View My Appeals">
                    <mat-icon class="block-icon">history</mat-icon>
                  </button>
                </div>
              </div>

            </div>
            }
          </td>
          }
        </tr>
        }
      </tbody>
    </table>

    <button
      mat-fab
      [class.mat-mdc-extended-fab]="isLabelVisible"
      class="export-pdf-fab"
      [@fabAnimation]="isLabelVisible ? 'extended' : 'collapsed'"
      (click)="onExportPdf()">
      <mat-icon class="fab-icon">{{
        showPreview ? 'picture_as_pdf' : 'download'
      }}</mat-icon>
      <span class="fab-label">
        {{ showPreview ? 'Export PDF' : 'Download PDF' }}
      </span>
    </button>
  </div>
</div>